# ç½‘ç»œç›¸æœºæ¨¡å—åŒ–é‡æ„ - è¿›åº¦æ€»ç»“

## ğŸ“‹ ä»»åŠ¡ç›®æ ‡

å°†ç½‘ç»œç›¸æœºåŠŸèƒ½é‡æ„ä¸ºæ¨¡å—åŒ–æ¶æ„ï¼š
- **Camera Core**: é€šç”¨ç›¸æœºèƒ½åŠ›ï¼ˆdevices/snapshot/latest è½®è¯¢é¢„è§ˆï¼‰
- **Line Modules**: äº§çº¿ä¸šåŠ¡å±‚ï¼ˆController/Motorï¼‰è§£è€¦ä½†å…±äº« Core
- **API é‡æ„**: ä» video_feed (MJPEGæµ) æ”¹ä¸º snapshot æ¨¡å¼ï¼ˆå›¾ç‰‡è½®è¯¢ï¼‰

## âœ… å·²å®Œæˆçš„æ–‡ä»¶

### Camera Core æ¨¡å—ï¼ˆé€šç”¨å±‚ï¼‰
1. âœ… `src/modules/camera-core/types.ts` - ç±»å‹å®šä¹‰
2. âœ… `src/modules/camera-core/api.ts` - API è°ƒç”¨å°è£…
3. âœ… `src/modules/camera-core/useCameraDevices.ts` - è®¾å¤‡åˆ—è¡¨ Hook
4. âœ… `src/modules/camera-core/useCameraPreview.ts` - é¢„è§ˆè½®è¯¢ Hook
5. âœ… `src/modules/camera-core/components/CameraSelector.tsx` - ç›¸æœºé€‰æ‹©å™¨
6. âœ… `src/modules/camera-core/components/CameraPreview.tsx` - é¢„è§ˆçª—å£ï¼ˆè½®è¯¢æ¨¡å¼ï¼‰
7. âœ… `src/modules/camera-core/components/SnapshotButton.tsx` - æŠ“æ‹æŒ‰é’®
8. âœ… `src/modules/camera-core/components/StatusBanner.tsx` - çŠ¶æ€æ¨ªå¹…
9. âœ… `src/modules/camera-core/components/CameraPanel.tsx` - é›†æˆé¢æ¿
10. âœ… `src/modules/camera-core/index.ts` - å¯¼å‡ºç´¢å¼•

### Line Modulesï¼ˆä¸šåŠ¡å±‚ï¼‰
11. âœ… `src/modules/lines/types.ts` - äº§çº¿ç±»å‹å®šä¹‰
12. âœ… `src/modules/lines/controller/index.ts` - æ§åˆ¶å™¨äº§çº¿é…ç½®
13. âœ… `src/modules/lines/motor/index.ts` - ç”µæœºäº§çº¿é…ç½®
14. âœ… `src/modules/lines/registry.ts` - äº§çº¿æ³¨å†Œè¡¨
15. âœ… `src/modules/lines/index.ts` - å¯¼å‡ºç´¢å¼•

### API é‡æ„ï¼ˆé¡µé¢å±‚ï¼‰
16. âœ… `src/app/api/camera-proxy/route.ts` - é‡å†™ä¸º snapshot æ¨¡å¼
17. âœ… `src/app/cameras/page.tsx` - ç›¸æœºç®¡ç†é¡µé¢
18. âœ… `src/components/layout/Navbar.tsx` - æ·»åŠ ç›¸æœºç®¡ç†å…¥å£

## âœ… æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ

### å·²å®Œæˆçš„é‡æ„å†…å®¹

**1. Camera Proxy API é‡å†™** âœ…
- ç§»é™¤äº† `video_feed` å’Œ `status` ç«¯ç‚¹
- åªä¿ç•™ 3 ä¸ªç«¯ç‚¹ï¼š`devices`, `snapshot`, `latest`
- `latest` ç«¯ç‚¹ç›´æ¥é€ä¼  image/jpeg
- æ·»åŠ äº†å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œå‚æ•°éªŒè¯

**2. ç›¸æœºç®¡ç†é¡µé¢** âœ…
- åˆ›å»ºäº† `/cameras` é¡µé¢
- æ”¯æŒäº§çº¿ Tabs åˆ‡æ¢ï¼ˆæ§åˆ¶å™¨/ç”µæœºï¼‰
- é›†æˆ CameraPanel ç»„ä»¶
- ä½¿ç”¨ LINE_MODULES æ³¨å†Œè¡¨åŠ¨æ€æ¸²æŸ“

**3. Navbar å¯¼èˆªæ›´æ–°** âœ…
- æ·»åŠ äº†"ç›¸æœºç®¡ç†"å¯¼èˆªé“¾æ¥
- å¯¼å…¥äº† Camera å›¾æ ‡
- æ”¯æŒå½“å‰é¡µé¢é«˜äº®

## âŒ å¾…å®Œæˆçš„ä»»åŠ¡

### 4. æµ‹è¯•éªŒè¯

**éªŒè¯æ¸…å•**:
- [ ] `/cameras` é¡µé¢å¯è®¿é—®
- [ ] Tabs åˆ‡æ¢æ­£å¸¸
- [ ] æ§åˆ¶å™¨äº§çº¿æ˜¾ç¤ºç›¸æœºåˆ—è¡¨
- [ ] ç”µæœºäº§çº¿æ˜¾ç¤º"æœªé…ç½®"æç¤º
- [ ] é¢„è§ˆå›¾ç‰‡è½®è¯¢åˆ·æ–°ï¼ˆ1ç§’é—´éš”ï¼‰
- [ ] æŠ“æ‹æŒ‰é’®å·¥ä½œæ­£å¸¸
- [ ] Network é¢æ¿ä¸å†å‡ºç° `video_feed` è¯·æ±‚
- [ ] åªæœ‰ `devices`, `snapshot`, `latest` è¯·æ±‚

## ğŸ”§ éƒ¨ç½²æ­¥éª¤

å®Œæˆåæ‰§è¡Œï¼š
```bash
npm run build
pm2 restart production-line-qc
```

## ğŸ“ æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Camera Core (é€šç”¨å±‚)                    â”‚
â”‚  - API å°è£…                              â”‚
â”‚  - Hooks (devices, preview)             â”‚
â”‚  - é€šç”¨ç»„ä»¶ (Selector, Preview, Panel)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†‘
                  â”‚ è°ƒç”¨
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Line Modules (ä¸šåŠ¡å±‚)                   â”‚
â”‚  - Controller Line (cameraIds: [...])   â”‚
â”‚  - Motor Line (cameraIds: [])           â”‚
â”‚  - Registry (é›†ä¸­æ³¨å†Œ)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†‘
                  â”‚ ä½¿ç”¨
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pages (é¡µé¢å±‚)                          â”‚
â”‚  - /cameras (Tabs + CameraPanel)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### æµ‹è¯•éªŒè¯æ¸…å•

åœ¨æœ¬åœ°æˆ–ç”Ÿäº§ç¯å¢ƒéªŒè¯ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **é¡µé¢è®¿é—®**
   - [ ] è®¿é—® `/cameras` é¡µé¢æ­£å¸¸åŠ è½½
   - [ ] é¡µé¢éœ€è¦ç™»å½•ï¼ˆAuthGuard ç”Ÿæ•ˆï¼‰
   - [ ] Navbar æ˜¾ç¤º"ç›¸æœºç®¡ç†"é“¾æ¥

2. **äº§çº¿åˆ‡æ¢**
   - [ ] Tabs æ˜¾ç¤º"æ§åˆ¶å™¨äº§çº¿"å’Œ"ç”µæœºäº§çº¿"
   - [ ] ç‚¹å‡» Tab å¯ä»¥æ­£å¸¸åˆ‡æ¢
   - [ ] åˆ‡æ¢æ—¶ URL ä¸å˜ï¼ˆå®¢æˆ·ç«¯çŠ¶æ€ï¼‰

3. **æ§åˆ¶å™¨äº§çº¿**
   - [ ] æ˜¾ç¤ºç›¸æœºåˆ—è¡¨ï¼ˆå¦‚æœè¾¹ç¼˜æœºåœ¨çº¿ï¼‰
   - [ ] é¢„è§ˆå›¾ç‰‡æ¯ç§’åˆ·æ–°ï¼ˆè½®è¯¢æ¨¡å¼ï¼‰
   - [ ] æŠ“æ‹æŒ‰é’®å¯ç‚¹å‡»å¹¶è§¦å‘ POST è¯·æ±‚
   - [ ] æŠ“æ‹æˆåŠŸæ˜¾ç¤ºæˆåŠŸæç¤º

4. **ç”µæœºäº§çº¿**
   - [ ] æ˜¾ç¤º"æš‚æ— å¯ç”¨ç›¸æœº"æˆ–"æœªé…ç½®"æç¤º
   - [ ] ä¸æ˜¾ç¤ºç›¸æœºé€‰æ‹©å™¨ï¼ˆcameraIds ä¸ºç©ºï¼‰

5. **Network é¢æ¿éªŒè¯**
   - [ ] ä¸å†å‡ºç° `endpoint=video_feed` è¯·æ±‚ âœ…
   - [ ] åªæœ‰ `endpoint=devices` è¯·æ±‚ï¼ˆåŠ è½½æ—¶ï¼‰
   - [ ] åªæœ‰ `endpoint=latest` è¯·æ±‚ï¼ˆè½®è¯¢é¢„è§ˆï¼Œ1ç§’é—´éš”ï¼‰
   - [ ] åªæœ‰ `endpoint=snapshot` è¯·æ±‚ï¼ˆç‚¹å‡»æŠ“æ‹æ—¶ï¼‰

6. **é”™è¯¯å¤„ç†**
   - [ ] è¾¹ç¼˜æœºç¦»çº¿æ—¶æ˜¾ç¤ºé”™è¯¯æç¤º
   - [ ] ç›¸æœºä¸å­˜åœ¨æ—¶æ˜¾ç¤ºé”™è¯¯æç¤º
   - [ ] ç½‘ç»œé”™è¯¯æ—¶æ˜¾ç¤ºå‹å¥½æç¤º

### éƒ¨ç½²æ­¥éª¤

å®Œæˆæµ‹è¯•åï¼Œéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼š

```bash
# 1. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# 2. é‡å¯æœåŠ¡
pm2 restart production-line-qc

# 3. éªŒè¯æœåŠ¡çŠ¶æ€
pm2 status
pm2 logs production-line-qc --lines 50
```

### è¾¹ç¼˜æœº API è¦æ±‚

ç¡®ä¿è¾¹ç¼˜æœº FastAPI æä¾›ä»¥ä¸‹ç«¯ç‚¹ï¼š

- `GET /api/camera/devices` - è¿”å›ç›¸æœºåˆ—è¡¨
- `POST /api/camera/snapshot?camera_id=XXX` - è§¦å‘æŠ“æ‹
- `GET /api/camera/latest?camera_id=XXX&t=timestamp` - è¿”å›æœ€æ–°å›¾ç‰‡ï¼ˆimage/jpegï¼‰

---

## ğŸ‰ é‡æ„å®Œæˆæ€»ç»“

### æ¶æ„æ”¹è¿›

1. **æ¨¡å—åŒ–è®¾è®¡**
   - Camera Core æä¾›é€šç”¨ç›¸æœºèƒ½åŠ›
   - Line Modules å®šä¹‰ä¸šåŠ¡é…ç½®
   - æ–°å¢äº§çº¿åªéœ€æ·»åŠ  LineModule åˆ° registry

2. **API ç®€åŒ–**
   - ä» MJPEG æµæ”¹ä¸º snapshot è½®è¯¢
   - ç§»é™¤äº†å¤æ‚çš„æµå¤„ç†é€»è¾‘
   - æ›´æ¸…æ™°çš„é”™è¯¯å¤„ç†

3. **å¯æ‰©å±•æ€§**
   - æ–°å¢äº§çº¿ï¼šæ·»åŠ ä¸€ä¸ª LineModule
   - æ–°å¢ç›¸æœºï¼šæ›´æ–° cameraIds æ•°ç»„
   - æ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç 

### æ–‡ä»¶æ¸…å•

**æ–°å¢æ–‡ä»¶ï¼ˆ18ä¸ªï¼‰**:
- Camera Core: 10 ä¸ªæ–‡ä»¶
- Line Modules: 5 ä¸ªæ–‡ä»¶
- Pages: 1 ä¸ªæ–‡ä»¶ï¼ˆcameras/page.tsxï¼‰
- API: 1 ä¸ªæ–‡ä»¶ï¼ˆé‡å†™ camera-proxyï¼‰
- Layout: 1 ä¸ªæ–‡ä»¶ï¼ˆæ›´æ–° Navbarï¼‰

**åˆ é™¤åŠŸèƒ½**:
- video_feed ç«¯ç‚¹ï¼ˆMJPEG æµï¼‰
- status ç«¯ç‚¹ï¼ˆæ”¹ç”¨ /healthï¼‰

**ä¿ç•™åŠŸèƒ½**:
- devices ç«¯ç‚¹ï¼ˆç›¸æœºåˆ—è¡¨ï¼‰
- snapshot ç«¯ç‚¹ï¼ˆæŠ“æ‹ï¼‰
- latest ç«¯ç‚¹ï¼ˆæœ€æ–°å›¾ç‰‡ï¼Œæ–°å¢ï¼‰

---

**æ³¨æ„**: è¾¹ç¼˜æœº FastAPI éœ€è¦æä¾›ä»¥ä¸‹ç«¯ç‚¹ï¼š
- `GET /api/camera/devices`
- `POST /api/camera/snapshot?camera_id=XXX`
- `GET /api/camera/latest?camera_id=XXX&t=timestamp` (è¿”å› image/jpeg)
